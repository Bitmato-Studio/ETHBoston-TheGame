<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Portfolio App</title>
    <!-- Add Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .floating-container {
            position: relative;
            overflow: hidden;
            height: 200px;
        }
        .floating-button {
            position: absolute;
            transition: transform 5s linear;
        }

        .custom-border {
            border: 1px solid #E5E7EB;
            padding: 1rem;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased">

    <h1 class="text-4xl font-bold my-8 text-center">Stock Portfolio App</h1>

    <div class="container mx-auto">
        <div class="flex">
            <!-- Company Prices Section -->
            <div class="w-1/2 mr-8">
                <h2 class="text-2xl font-bold mb-4">Company Prices</h2>
                <table class="w-full table-auto">
                    <thead>
                        <tr>
                            <th class="custom-border">Company</th>
                            <th class="custom-border">Price</th>
                            <th class="custom-border">Total Shares</th>
                            <th class="custom-border">Total Market Cap</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for company in companies %}
                            <tr>
                                <td class="custom-border">{{ company.name }}</td>
                                <td class="custom-border">{{ company.value }}</td>
                                <td class="custom-border">{{ company.total_shares }}</td>
                                <td class="custom-border">{{ company.value * company.total_shares }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Trade Shares Section -->
            <div class="w-1/2">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold mb-4">Trade Shares</h2>
                    <form method="POST" action="/trade">
                        <div class="mb-3">
                            <label for="company" class="font-semibold">Company</label>
                            <select class="w-full border border-gray-300 p-2" id="company" name="company">
                                {% for company in companies %}
                                    <option value="{{ company.name }}">{{ company.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="shares" class="font-semibold">Number of shares</label>
                            <input type="number" class="w-full border border-gray-300 p-2" id="shares" name="shares" min="1">
                        </div>
                        <div class="flex space-x-4">
                            <button type="submit" name="action" value="Buy" class="w-1/2 py-2 px-4 bg-green-600 text-white font-bold rounded hover:bg-green-500">Buy</button>
                            <button type="submit" name="action" value="Sell" class="w-1/2 py-2 px-4 bg-red-600 text-white font-bold rounded hover:bg-red-500">Sell</button>
                        </div>
                    </form>
                </div>
    
                <!-- User Portfolio Section -->
                <div>
                    <h2 class="text-2xl font-bold mb-4">User Portfolio</h2>
                    <table class="w-full table-auto">
                        <thead>
                            <tr>
                                <th class="custom-border">Company</th>
                                <th class="custom-border">Shares</th>
                                <th class="custom-border">Total Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for holding in holdings_with_value %}
                                <tr>
                                    <td class="custom-border">{{ holding[0] }}</td>
                                    <td class="custom-border">{{ holding[1] }}</td>
                                    <td class="custom-border">{{ holding[2] }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- Vote for Companies Section -->
                <div>
                    <h2 class="text-2xl font-bold mb-4">Vote for Companies</h2>
                    <div class="floating-container">
                        {% for company in companies %}
                            <form method="POST" action="/vote" class="floating-button" id="vote-form-{{ loop.index }}" style="top: {{ loop.index * 10 }}px; left: {{ loop.index * 20 }}px;">
                                <input type="hidden" name="company" value="{{ company.name }}">
                                <button type="submit" class="bg-blue-600 text-white w-16 h-16 rounded-full flex items-center justify-center text-xs leading-tight px-1">
                                    <div class="text-center">
                                        <div>{{ company.name }}: <span class="vote-count">{{ company.clicks }}</span></div>
                                    </div>
                                </button>                                
                            </form>
                        {% endfor %}
                    </div>
                </div>

                <script>
                    // Animate the floating buttons
                    const buttons = document.querySelectorAll('.floating-button');
                    buttons.forEach(button => {
                        const container = document.querySelector('.floating-container');
                        const maxX = container.offsetWidth - button.offsetWidth;
                        const maxY = container.offsetHeight - button.offsetHeight;
                        setInterval(() => {
                            const randomX = Math.random() * maxX;
                            const randomY = Math.random() * maxY;
                            button.style.transform = `translate(${randomX}px, ${randomY}px)`;
                        }, 5000);
                    });

                    // Submit the form asynchronously
                    buttons.forEach(button => {
                        button.addEventListener('submit', (event) => {
                            event.preventDefault(); // Prevent default form submission behavior
                            const formData = new FormData(event.target);
                            fetch(event.target.action, {
                                method: 'POST',
                                body: formData
                            }).then(response => {
                                return response.json();
                            }).then(data => {
                                // Update the vote count displayed in the bubble
                                const voteCountElement = button.querySelector('.vote-count');
                                voteCountElement.textContent = data.vote_count;
                            }).catch(error => {
                                // Handle error
                            });
                        });
                    });
                </script>


            </div>
        </div>
    </div>

</body>
</html>
